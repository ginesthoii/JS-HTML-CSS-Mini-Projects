<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Color Hex Extractor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: #f5f5f5;
    }
    .drop-zone {
      border: 2px dashed #999;
      border-radius: 10px;
      width: 400px;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      background: white;
      margin-bottom: 20px;
      cursor: pointer;
    }
    .colors {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      max-width: 400px;
    }
    .color-swatch {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 80px;
    }
    .swatch-box {
      width: 60px;
      height: 60px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .hex {
      margin-top: 5px;
      font-size: 12px;
    }
    canvas { display: none; }
  </style>
</head>
<body>
  <h1>Image Color Hex Extractor</h1>
  <div class="drop-zone" id="dropZone">
    Drag & drop an image here or click to upload
    <input type="file" id="fileInput" accept="image/*" hidden>
  </div>
  <canvas id="canvas"></canvas>
  <div class="colors" id="colors"></div>

  <script>
    const dropZone = document.getElementById("dropZone");
    const fileInput = document.getElementById("fileInput");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const colorsContainer = document.getElementById("colors");

    // Convert RGB to hex
    function rgbToHex(r, g, b) {
      return "#" + [r, g, b].map(x => {
        const hex = x.toString(16);
        return hex.length === 1 ? "0" + hex : hex;
      }).join("");
    }

    // Process image and extract hex colors
    function extractColors(image) {
      canvas.width = image.width;
      canvas.height = image.height;
      ctx.drawImage(image, 0, 0);

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      const colorCount = {};

      for (let i = 0; i < imageData.length; i += 4) {
        const [r, g, b, a] = imageData.slice(i, i + 4);
        if (a < 128) continue; // skip transparent pixels
        const hex = rgbToHex(r, g, b);
        colorCount[hex] = (colorCount[hex] || 0) + 1;
      }

      // Sort by frequency
      const sorted = Object.entries(colorCount).sort((a, b) => b[1] - a[1]);
      displayColors(sorted.slice(0, 12)); // show top 12
    }

    // Display color swatches
    function displayColors(colors) {
      colorsContainer.innerHTML = "";
      colors.forEach(([hex]) => {
        const div = document.createElement("div");
        div.className = "color-swatch";
        div.innerHTML = `
          <div class="swatch-box" style="background:${hex}"></div>
          <div class="hex">${hex}</div>
        `;
        colorsContainer.appendChild(div);
      });
    }

    // Handle file upload
    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => extractColors(img);
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    // Drag & drop handlers
    dropZone.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

    dropZone.addEventListener("dragover", e => {
      e.preventDefault();
      dropZone.style.borderColor = "#333";
    });

    dropZone.addEventListener("dragleave", () => {
      dropZone.style.borderColor = "#999";
    });

    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      dropZone.style.borderColor = "#999";
      if (e.dataTransfer.files.length) {
        handleFile(e.dataTransfer.files[0]);
      }
    });
  </script>
</body>
</html>